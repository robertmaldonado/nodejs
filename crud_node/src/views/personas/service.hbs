<div class="container mt-4">
    <h2 class="text-center mb-4">Agregar Servicio</h2>


    <form action="/cadd" method="post" id="form">
        <!-- Tarjeta para Datos del Cliente -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Datos del Cliente</h5>
            </div>
            <div class="card-body">
                <!-- Usamos row para organizar los inputs -->
                <div class="row">
                    <!-- Cada input ocupa 12 columnas en móvil y 4 en escritorio (3 columnas en total) -->
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Telefono</label>
                            <input type="text" class="form-control" id="telefono" value="{{cliente.telefono}}"
                                placeholder="Ingrese su nombre">
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="email" class="form-control" id="nombre" value="{{cliente.nombre}} "
                                placeholder="Ingrese su correo">
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="ubicacion" class="form-label">ubicacion</label>
                            <input type="text" class="form-control" id="ubicacion" value="{{cliente.ubicacion}} "
                                placeholder="Ingrese su dirección">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- Cada input ocupa 12 columnas en móvil y 4 en escritorio (3 columnas en total) -->
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="cedula" class="form-label">Cedula</label>
                            <input type="text" class="form-control" id="cedula" value="{{cliente.cedula}} "
                                placeholder="Ingrese su nombre">
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="correo" class="form-label">Correo</label>
                            <input type="email" class="form-control" id="correo" value="{{cliente.correo}} "
                                placeholder="Ingrese su correo">
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="fecha" class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="fecha" value="{{cliente.fecha}}"
                                placeholder="Ingrese su dirección">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- Cada input ocupa 12 columnas en móvil y 4 en escritorio (3 columnas en total) -->
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="nombreCliente" class="form-label">Cedula</label>
                            <input type="text" class="form-control" id="nombreCliente" placeholder="Ingrese su nombre"
                                disabled>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="emailCliente" class="form-label">Correo</label>
                            <input type="email" class="form-control" id="emailCliente" placeholder="Ingrese su correo"
                                disabled>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="mb-3">
                            <label for="direccionCliente" class="form-label">Fecha</label>
                            <input type="text" class="form-control" id="direccionCliente"
                                placeholder="Ingrese su dirección" disabled>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="mb-3">
                        <label for="nota" class="form-label">Falla del equipo </label>
                        <textarea class="form-control" name="nota" id="nota" rows="3"
                            placeholder="agregar alguna nota de precaucuion sobre el cliente" disabled></textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="mb-3">
                            <label for="nota" class="form-label">Falla del equipo </label>
                            <textarea class="form-control" name="nota" id="nota" rows="3"
                                placeholder="agregar alguna nota de precaucuion sobre el cliente" disabled></textarea>
                        </div>

                    </div>

                </div>
                <div class="row mb-3">

                    <div class="col-md-4">


                        <label for="saldo" class="form-label">saldo</label>
                        <input class="form-control" type="number" step="0.01" name="saldo" id="saldo"
                            placeholder=" gasto total del cliente" readonly>

                        <input type="hidden" name="variable_oculta" id="variable_oculta" value="valor_predefinido">


                    </div>

                </div>

            </div>
        </div>




        <!-- Tarjeta para Datos del Servicio Técnico -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Datos del Servicio Técnico</h5>
            </div>
            <div class="card-body">


                <!-- Primera fila -->
                <div class="row mb-3">

                    <div class="col-md-2">
                        <label for="nivel" class="form-label">Procedencia</label>
                        <select class="form-select" id="equipo" aria-label="Default select example">
                            <option>Selecciona un nivel</option>
                            <option value="alto" selected>Servicio </option>
                            <option value="medio">Venta</option>


                        </select>
                    </div>

                    <div class="col-md-2">
                        <label for="nivel" class="form-label">equipo</label>
                        <select class="form-select" id="equipo" aria-label="Default select example">
                            <option selected>Selecciona un nivel</option>
                            <option value="alto">tv</option>
                            <option value="medio">freidora</option>
                            <option value="bajo">sonido</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                        <label for="nivel" class="form-label">Estatus</label>
                        <select class="form-select" id="nivel" aria-label="Default select example">
                            <option selected>Selecciona un nivel</option>
                            <option value="alto" selected> Recibido</option>
                            <option value="medio">Revision</option>
                            <option value="bajo">Presupuesto</option>
                            <option value="medio">Reparando</option>
                            <option value="bajo">Reparado</option>
                            <option value="medio">Entregado</option>
                            <option value="bajo">Repuestos</option>
                            <option value="bajo">Irreparable </option>
                            <option value="bajo">Garantia</option>




                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="fechain" class="form-label">Fecha de entrada</label>
                        <input type="date" class="form-control" name="fechain" id="fechain">
                    </div>
                    <div class="col-md-2">
                        <label for="fechaout" class="form-label">Fecha de salida</label>
                        <input type="date" class="form-control" name="fechaout" id="fechaout">
                    </div>
                    <div class="col-md-2">
                        <label for="fechain" class="form-label">Estimada Entrega</label>
                        <input type="date" class="form-control" name="fechain" id="fechain">
                    </div>

                </div>

                <!-- Segunda fila -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="fecha2" class="form-label">Serial</label>
                        <input type="date" class="form-control" id="fecha2">
                    </div>
                    <div class="col-md-4">
                        <label for="direccion" class="form-label">Modelo</label>
                        <input type="text" class="form-control" id="direccion" placeholder="Ingresa tu dirección">
                    </div>

                    <div class="col-md-4">
                        <label for="nivel" class="form-label">Marca</label>
                        <select class="form-select" id="nivel" aria-label="Default select example">
                            <option selected>Selecciona un nivel</option>
                            <option value="alto">revisar</option>
                            <option value="medio">revisado</option>
                            <option value="bajo">retirado</option>
                        </select>
                    </div>
                </div>

                <!-- Segunda fila -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="fecha2" class="form-label">Presupuesto</label>
                        <input type="date" class="form-control" id="fecha2">
                    </div>
                    <div class="col-md-4">
                        <label for="direccion" class="form-label">Abono</label>
                        <input type="text" class="form-control" id="direccion" placeholder="Ingresa tu dirección">
                    </div>

                    <div class="col-md-4">
                        <label for="nivel" class="form-label">Pulgadas</label>
                        <select class="form-select" id="nivel" aria-label="Default select example">
                            <option selected>Selecciona Pulgadas</option>
                            <option value="alto">24</option>
                            <option value="medio">28</option>
                            <option value="bajo">32</option>
                        </select>
                    </div>
                </div>
                <!-- Segunda fila -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="fecha2" class="form-label">NC</label>
                        <input type="date" class="form-control" id="fecha2" disabled>
                    </div>
                    <div class="col-md-4">
                        <label for="nivel" class="form-label">Metodo de pago</label>
                        <select class="form-select" id="nivel" aria-label="Default select example">
                            <option selected>Selecciona un nivel</option>
                            <option value="alto">yappyr</option>
                            <option value="medio">yappym</option>
                            <option value="bajo">ACH</option>
                            <option value="bajo">Efectivo</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label for="nivel" class="form-label">Tiempo de reparacion</label>
                        <select class="form-select" id="nivel" aria-label="Default select example" disabled>
                            <option selected>Selecciona un nivel</option>
                            <option value="alto">revisar</option>
                            <option value="medio">revisado</option>
                            <option value="bajo">retirado</option>
                        </select>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="mb-3">
                        <label for="nota" class="form-label">Falla del equipo </label>
                        <textarea class="form-control" name="nota" id="nota" rows="3"
                            placeholder="agregar alguna nota de precaucuion sobre el cliente"></textarea>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="mb-3">
                        <label for="nota" class="form-label">Daño del equipo (Tecnico) </label>
                        <textarea class="form-control" name="nota" id="nota" rows="3"
                            placeholder="agregar alguna nota de precaucuion sobre el cliente"></textarea>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="mb-3">
                        <label for="nota" class="form-label">dESCRICION VENTA </label>
                        <textarea class="form-control" name="nota" id="nota" rows="3"
                            placeholder="agregar alguna nota de precaucuion sobre el cliente" disabled></textarea>
                    </div>
                </div>

                <!--  fila  4 -->
                <div class="row mb-3">

                    <div class="col-md-4">


                        <label for="saldo" class="form-label">NC</label>
                        <input class="form-control" type="number" step="0.01" name="saldo" id="saldo"
                            placeholder=" gasto total del cliente" readonly>

                        <input type="hidden" name="variable_oculta" id="variable_oculta" value="valor_predefinido">


                    </div>

                </div>



            </div>
        </div>






        <!-- Botón de enviar -->
        <div class="form-group mt-4 d-grid gap-2">
            <button class="btn btn-success"> Crear</button>
        </div>
    </form>
</div>










<!-- Importar el archivo JavaScript como módulo -->
{{!--
<script type="module" src="/js/procesar.js"></script> --}}






<script>
    //se ejecuta cuando termina de cargar el DOM
    document.addEventListener("DOMContentLoaded", function () {
        const fechaInput = document.getElementById("fechain");
        const hoy = new Date().toISOString().split("T")[0]; // Formato YYYY-MM-DD
        fechaInput.value = hoy; // Asigna la fecha actual al input
        console.log('sumando');
    });
</script>



//
<script>
    //  document.getElementById("telefono").addEventListener("input", function () {
    //    let valor = this.value.replace(/\D/g, ""); // Elimina caracteres no numéricos
    //  if (valor.length > 4) {
    //     valor = valor.slice(0, 4) + "-" + valor.slice(4, 8);
    // }
    // this.value = valor;
    // console.log('teclas');
    // });
</script>



<script>


    // document.getElementById("telefono").addEventListener("change", function () {
    //    console.log("Número ingresado:", this.value);
    // });





    document.getElementById('telefono').addEventListener('change', async () => {

        // const telefono = document.getElementById("telefonob").value;

        //console.log("telefono ingresado:", telefono.value);
        console.log("name:", nombre.value);
        console.log("ubicacion:", ubicacion.value);
        console.log("cedula:", cedula.value);
        console.log("correo:", correo.value);
        console.log("fecha:", fecha.value);
        console.log('teclas');




        const telefono = document.getElementById("telefono").value;
        if (!telefono) return; // Si no hay teléfono, sale inmediatamente

        try {
            // Solicitud POST con fetch
            const response = await fetch("/check-cedula", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ telefono })
            });

            if (!response.ok) throw new Error(`Error en la solicitud: ${response.status}`);

            const data = await response.json();
            console.log(data);

            if (data.exists) {
                const campos = {
                    name: "nombre",
                    correo: "correo",
                    fecha: "fecha",
                    telefono: "telefono",
                    // nota: "nota",
                    //saldo: "saldo",
                    cedula: "cedula",
                    address: "ubicacion"
                };

                Object.entries(campos).forEach(([key, id]) => {
                    document.getElementById(id).value = data.data[key] || "";
                });

                // Actualizar valores exportables
                document.getElementById("variable_oculta").value = data.data.cedula || "";
            }

        } catch (error) {
            console.error("Error al verificar la cédula:", error.message);
        }


    });










</script>




<script type="module">
    import { saludar, sumar, restar } from '/js/procesar.js';

    saludar('Juan');
    console.log(sumar(5, 3));
    console.log(restar(10, 4));
</script>

{{!--
<script type="module" src="/js/main.js"></script> --}}